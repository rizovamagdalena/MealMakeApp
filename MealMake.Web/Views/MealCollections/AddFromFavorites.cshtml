@model MealMake.Domain.ViewModels.AddMealFromFavoritesViewModel

@{
    ViewData["Title"] = $"Add Meals to {Model.CollectionName}";
    Guid collectionId = Model.CollectionId;
}

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>🍽️ Add Meals to <strong>@Model.CollectionName</strong></h2>
        <a asp-controller="MealCollections"
           asp-action="Details"
           asp-route-id="@collectionId"
           class="btn btn-secondary">
            🔙 Back to Collection
        </a>
    </div>

    <hr />

    @if (!Model.FavoriteMeals.Any())
    {
        <div class="alert alert-info">
            No favorite meals available.
        </div>
    }
    else
    {
        <div class="row g-3 mt-2">
            @foreach (var meal in Model.FavoriteMeals)
            {
                <div class="col-md-3">
                    <div class="card shadow-sm h-100 border-0">
                        <img src="@meal.Thumbnail"
                             class="card-img-top"
                             style="height:200px; object-fit:cover;"
                             alt="@meal.Name" />

                        <div class="card-body text-center">
                            <h5 class="card-title">@meal.Name</h5>
                            <a asp-controller="Meals"
                               asp-action="Details"
                               asp-route-id="@meal.Id"
                               class="btn btn-outline-primary btn-sm mb-2">
                                View Details
                            </a>

                            <form class="favorite-add-remove-form"
                                  data-collection-id="@collectionId"
                                  data-meal-id="@meal.Id"
                                  method="post">
                                <button type="button"
                                        class="btn btn-sm @(meal.IsInCollection ? "btn-danger" : "btn-success")">
                                    @(meal.IsInCollection ? "❌ Remove from Collection" : "➕ Add to Collection")
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function(){
        $(document).on('click', '.favorite-add-remove-form button', function(){
            var btn = $(this);
            var form = btn.closest('form');
            var collectionId = form.data('collection-id');
            var mealId = form.data('meal-id');
            var action = btn.hasClass('btn-success') ? 'add' : 'remove';

            if(action === 'add'){
                $.post('/MealCollections/AddMealToCollection', { collectionId: collectionId, mealId: mealId })
                    .done(function(){
                        btn.removeClass('btn-success').addClass('btn-danger')
                           .text('❌ Remove from Collection');
                    })
                    .fail(function(){ alert('Failed to add meal!'); });
            }
            else {
                $.post('/MealCollections/RemoveMealFromCollection', { collectionId: collectionId, mealId: mealId })
                    .done(function(){
                        btn.removeClass('btn-danger').addClass('btn-success')
                           .text('➕ Add to Collection');
                    })
                    .fail(function(){ alert('Failed to remove meal!'); });
            }
        });
    });
</script>

